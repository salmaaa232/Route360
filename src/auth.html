<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sign in or Register — Route 360</title>

  <!-- keep your css, but we'll override auth styles below -->
  <link rel="stylesheet" href="dashboard.css">

  <!-- quick, clean auth override -->
  <style>
    :root{
      --bg:#0f172a; --card:#0b1220; --text:#e2e8f0; --muted:#94a3b8;
      --accent:#7c3aed; --accent2:#22c55e; --border:#1f2937;
    }
    *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
    body{
      margin:0; min-height:100vh; display:grid; place-items:center;
      background:
        radial-gradient(1200px circle at 0% -20%, #1e293b 0, transparent 60%),
        radial-gradient(900px circle at 100% 0%, #312e81 0, transparent 55%),
        var(--bg);
      color:var(--text);
    }
    .auth-main{width:100%; display:grid; place-items:center; padding:24px}
    .auth-card{
      width:min(420px, 94vw);
      background:rgba(255,255,255,0.03);
      border:1px solid var(--border);
      border-radius:18px;
      padding:22px 20px;
      box-shadow:0 10px 40px rgba(0,0,0,0.45);
      backdrop-filter: blur(6px);
    }
    .auth-title{margin:0 0 14px; font-size:22px; font-weight:700; letter-spacing:.2px}
    .auth-tabs{
      display:flex; gap:8px; padding:6px;
      background:#0a0f1c; border:1px solid var(--border);
      border-radius:12px; margin-bottom:12px;
    }
    .tab-btn{
      flex:1; padding:10px 12px; border-radius:9px; border:0;
      background:transparent; color:var(--muted); font-weight:600; cursor:pointer;
      transition:.15s ease;
    }
    .tab-btn.active{
      background:linear-gradient(135deg, rgba(124,58,237,.25), rgba(34,197,94,.18));
      color:var(--text);
      outline:1px solid rgba(124,58,237,.45);
    }
    .auth-form{display:grid; gap:8px; margin-top:6px}
    .label{font-size:13px; color:var(--muted)}
    .text-input{
      width:100%; padding:11px 12px; border-radius:10px;
      border:1px solid var(--border); background:#0a0f1c; color:var(--text);
      outline:none; transition:.15s ease;
    }
    .text-input:focus{
      border-color:rgba(124,58,237,.8);
      box-shadow:0 0 0 3px rgba(124,58,237,.15);
    }
    .auth-actions{
      display:flex; align-items:center; justify-content:space-between;
      margin-top:6px;
    }
    .btn{
      border:0; cursor:pointer; font-weight:700; color:white;
      padding:10px 14px; border-radius:10px;
      background:linear-gradient(135deg, var(--accent), #4f46e5);
      transition:.15s ease;
    }
    .btn:hover{transform:translateY(-1px); filter:brightness(1.05)}
    .home-link{
      font-size:13px; color:var(--muted); text-decoration:none;
    }
    .home-link:hover{color:var(--text); text-decoration:underline}
    .muted.small{font-size:13px; color:var(--muted); min-height:18px}
    .hidden{display:none !important}
  </style>
</head>

<body>
  <main class="auth-main">
    <div class="auth-card" id="authCard">
      <h2 class="auth-title">Welcome to Route 360</h2>

      <!-- tab controls -->
      <div class="auth-tabs" role="tablist" aria-label="Authentication tabs">
        <button type="button" id="tabSignIn" class="tab-btn active" role="tab" aria-selected="true">Sign in</button>
        <button type="button" id="tabRegister" class="tab-btn" role="tab" aria-selected="false">Register</button>
      </div>

      <!-- Sign in form -->
      <form id="signInForm" class="auth-form" autocomplete="on" data-view="signin" novalidate>
        <label class="label" for="siEmail">Email</label>
        <input id="siEmail" name="email" class="text-input" type="email" autocomplete="email" required>

        <label class="label" for="siPassword">Password</label>
        <input id="siPassword" name="password" class="text-input" type="password" autocomplete="current-password" required>

        <div class="form-actions auth-actions">
          <button type="submit" class="btn">Sign in</button>
          <a class="home-link" id="gotoRegisterLink" href="#">Create account</a>
        </div>

        <p id="siMsg" class="muted small" aria-live="polite"></p>
      </form>

      <!-- Register form -->
      <form id="registerForm" class="auth-form hidden" autocomplete="on" data-view="register" novalidate>
        <label class="label" for="regName">Full name</label>
        <input id="regName" name="name" class="text-input" type="text" autocomplete="name" required>

        <label class="label" for="regEmail">Email</label>
        <input id="regEmail" name="email" class="text-input" type="email" autocomplete="email" required>

        <label class="label" for="regPassword">Password</label>
        <input id="regPassword" name="password" class="text-input" type="password" minlength="6" autocomplete="new-password" required>

        <div class="form-actions auth-actions">
          <button type="submit" class="btn">Register</button>
          <a class="home-link" id="gotoSignInLink" href="#">Have an account? Sign in</a>
        </div>

        <p id="regMsg" class="muted small" aria-live="polite"></p>
      </form>

    </div>
  </main>

  <!-- your helpers -->
  <script src="auth.js" defer></script>

  <!-- your logic unchanged -->
  <script defer>
    document.addEventListener('DOMContentLoaded', () => {
      const tabSignIn = document.getElementById('tabSignIn');
      const tabRegister = document.getElementById('tabRegister');
      const signInForm = document.getElementById('signInForm');
      const registerForm = document.getElementById('registerForm');
      const gotoRegisterLink = document.getElementById('gotoRegisterLink');
      const gotoSignInLink = document.getElementById('gotoSignInLink');

      const siEmail = document.getElementById('siEmail');
      const siPassword = document.getElementById('siPassword');
      const siMsg = document.getElementById('siMsg');

      const regName = document.getElementById('regName');
      const regEmail = document.getElementById('regEmail');
      const regPassword = document.getElementById('regPassword');
      const regMsg = document.getElementById('regMsg');

      function showView(view) {
        const isSignIn = view === 'signin';
        tabSignIn.classList.toggle('active', isSignIn);
        tabRegister.classList.toggle('active', !isSignIn);
        tabSignIn.setAttribute('aria-selected', isSignIn);
        tabRegister.setAttribute('aria-selected', !isSignIn);

        signInForm.classList.toggle('hidden', !isSignIn);
        registerForm.classList.toggle('hidden', isSignIn);

        siMsg.textContent = '';
        regMsg.textContent = '';
      }

      tabSignIn.addEventListener('click', (e) => { e.preventDefault(); showView('signin'); });
      tabRegister.addEventListener('click', (e) => { e.preventDefault(); showView('register'); });
      gotoRegisterLink.addEventListener('click', (e) => { e.preventDefault(); showView('register'); });
      gotoSignInLink.addEventListener('click', (e) => { e.preventDefault(); showView('signin'); });

      signInForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        siMsg.textContent = '';

        const email = siEmail.value.trim().toLowerCase();
        const password = siPassword.value;

        const users = getAllUsers();
        const user = users.find(u => u.email === email);
        if (!user) { siMsg.textContent = 'No account found with that email.'; return; }

        try {
          const hash = await hashString(password);
          if (hash !== user.passwordHash) { siMsg.textContent = 'Incorrect password.'; return; }

          setCurrentUserId(user.id);
        window.location.replace('dashboard.html');
        } catch (err) {
          console.error(err);
          siMsg.textContent = 'Sign in failed — try again.';
        }
      });

      registerForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        regMsg.textContent = '';

        const name = regName.value.trim();
        const email = regEmail.value.trim().toLowerCase();
        const password = regPassword.value;

        if (!name || !email || !password) {
          regMsg.textContent = 'Please provide name, email and password.';
          return;
        }

        try {
          const existing = getAllUsers();
          if (existing.some(u => u.email === email)) {
            regMsg.textContent = 'An account with this email already exists.';
            return;
          }

          const passwordHash = await hashString(password);
          const id = 'u_' + Date.now();
          const user = { id, name, email, passwordHash, createdAt: new Date().toISOString() };

          existing.push(user);
          saveAllUsers(existing);

          setCurrentUserId(id);
          window.location.href = 'dashboard.html';
        } catch (err) {
          console.error(err);
          regMsg.textContent = 'Registration failed — try again.';
        }
      });


      showView('signin');
    });
  </script>
</body>
</html>
